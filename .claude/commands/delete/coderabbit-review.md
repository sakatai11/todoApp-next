---
allowed-tools: Bash(coderabbit *), Bash(git *), BashOutput(*)
description: CodeRabbit CLIでコードレビューを実行（バックグラウンド）
---

CodeRabbit CLIを使用してコードレビューを実行してください。`--prompt-only` オプションを指定し、バックグラウンドで実行します。

## 実行前の確認

まず、以下を確認してください：

1. **現在のブランチとコミット状況**
   ```bash
   git status
   git log --oneline -5
   ```

2. **レビュー対象の変更内容**
   ```bash
   git diff HEAD
   ```

## レビューの実行

### バックグラウンド実行

以下のコマンドをバックグラウンドで実行してください：

```bash
coderabbit --prompt-only
```

**重要**: `run_in_background: true` パラメータを使用してバックグラウンドで実行してください。

### レビュー進行状況の確認

バックグラウンド実行後、以下の手順で進行状況を確認します：

1. **shell_id を記録**
   - バックグラウンド実行時に返される shell_id を保持

2. **定期的に出力を確認**
   ```bash
   # BashOutput ツールを使用してバックグラウンドプロセスの出力を確認
   ```

3. **ユーザーへの進行状況報告**
   - レビュー開始時: 「CodeRabbitレビューをバックグラウンドで開始しました」
   - 進行中: 定期的に出力をチェックして状況を報告
   - 完了時: レビュー結果のサマリーを表示

## レビュー結果の整理

レビューが完了したら、以下の情報を整理して報告してください：

### 1. レビュー概要
- レビュー対象のファイル数
- 検出された問題の総数
- 重要度別の内訳（Critical, High, Medium, Low）

### 2. 主要な指摘事項
重要度の高い指摘事項をピックアップして表形式で表示：

| ファイル | 重要度 | 指摘内容 | 推奨対応 |
|---------|--------|---------|---------|
| ...     | ...    | ...     | ...     |

### 3. 推奨アクション
- 優先的に対応すべき項目
- 後回しにできる項目
- 議論が必要な項目

## オプション引数の対応

コマンド実行時に引数が指定された場合の動作：

```bash
/coderabbit-review [オプション]
```

引数として以下をサポート：
- `--verbose` - 詳細なログ出力を表示
- `--files <pattern>` - 特定のファイルパターンのみをレビュー
- `--severity <level>` - 特定の重要度以上の問題のみを表示

例：
```bash
/coderabbit-review --files "**/*.ts" --severity high
```

引数がある場合は `$ARGUMENTS` を使用してコマンドに追加してください：
```bash
coderabbit --prompt-only $ARGUMENTS
```

## エラーハンドリング

以下のエラーが発生した場合の対処：

1. **CodeRabbit CLIが見つからない**
   - インストール状況を確認
   - `npm install -g @coderabbit/cli` または `brew install coderabbit` の実行を提案

2. **認証エラー**
   - CodeRabbitの認証状態を確認
   - 再認証が必要かどうかを確認

3. **タイムアウト**
   - 大規模な変更の場合は時間がかかることを説明
   - 進行状況を定期的に確認

## 注意事項

- バックグラウンド実行により、他の作業を並行して実行できます
- レビューには数分かかる場合があります（変更量により異なる）
- `--prompt-only` オプションはプロンプト生成のみを行い、実際のAI呼び出しは行いません
- ネットワーク接続が必要です
- レビュー結果は標準出力に表示されます

## 完了後のアクション

レビュー完了後、ユーザーに以下を確認してください：

1. 指摘事項の修正を開始するか？
2. 特定の指摘について詳細な説明が必要か？
3. レビュー結果をファイルに保存するか？

ユーザーの要望に応じて次のアクションを実行してください。
