---
name: update-specs
description: git コミット履歴を基に/todoApp-submodule/docs 配下の仕様書を更新・作成。ユーザーが「仕様書を更新」「最近の変更を仕様書に反映」と言った時、または/update-specs コマンドが実行された時に使用する。develop-v2 ブランチを優先し、コミット範囲に応じて変更ファイルを特定して仕様書を自動生成・更新する。
---

# Update Specs

## Overview

gitコミット履歴を分析し、変更されたファイルに対応する仕様書を`todoApp-submodule/docs`配下に自動更新・作成する。

## Workflow

### 1. コミット範囲の決定

スクリプトを使用してコミット範囲を決定：

```bash
source scripts/determine_commit_range.sh "$ARGUMENTS"
```

**引数オプション**:

- 引数なし: デフォルトで直近5コミット（`HEAD~5..HEAD`）
- 数字のみ（例: `10`）: その数だけ直近のコミット（`HEAD~10..HEAD`）
- `-b`のみ: ブランチ切ってからの全コミット（`develop-v2..HEAD` または `main..HEAD`）
- 数字 + `-b`（例: `10 -b`）: ブランチ切ってから最新10件のコミット
- カスタム範囲（例: `HEAD~10..HEAD`）: 指定した範囲をそのまま使用

**⚠️ 重要: ベースブランチの優先順位**:

1. `develop-v2` (最優先)
2. `main` (develop-v2がない場合)

直接mainを指定することは禁止。

### 2. コミット履歴と変更ファイルの確認

```bash
# コミット履歴の表示
git log --oneline -${LOG_COUNT}

# 変更されたファイルの確認
git diff --name-only ${COMMIT_RANGE}
```

### 3. 対象ファイルの分類

**ファイルマッピングルール**: `references/file-mapping.md`を参照してマッピングルールを確認。

仕様書が必要なファイル:
- `app/**/*.ts(x)` - ページ、API、ライブラリ
- `features/**/*.ts(x)` - コンポーネント、フック、コンテキスト
- `types/**/*.ts` - 型定義
- `constants/**/*.ts` - 定数
- `scripts/**/*.ts` - スクリプト

除外:
- `tests/**/*.test.ts(x)`
- `*.config.ts`
- `.claude/**`

### 4. 仕様書の更新・作成

#### 既存仕様書の確認

```bash
find todoApp-submodule/docs -name "*.md" -type f
```

#### ファイル内容の確認

- `git diff ${COMMIT_RANGE} <file-path>` で変更内容を確認
- `Read`ツールで現在の完全な内容を確認
- Serena MCPツール（`get_symbols_overview`, `find_symbol`）でコード構造を分析

#### 新規作成と更新

**新規作成**: `references/spec-template.md`のテンプレートを使用。

**更新時の手順**:
1. 既存仕様書を読み取り
2. 変更内容を分析（機能追加/修正/削除/改善）
3. 該当セクションを更新
4. 変更履歴に追記

### 5. 実行結果の報告

完了後、以下をユーザーに報告：

```markdown
## 📊 更新サマリー

| カテゴリ       | 新規作成 | 更新 | 変更なし |
| -------------- | -------- | ---- | -------- |
| コンポーネント | X件      | Y件  | Z件      |
| フック         | X件      | Y件  | Z件      |
| その他         | X件      | Y件  | Z件      |

## 主な変更内容

- 新規作成: ファイル名と概要
- 更新: ファイル名と変更内容
- 注意が必要な項目
```

## References

- **file-mapping.md**: ファイルと仕様書のマッピングルール
- **spec-template.md**: 仕様書テンプレートと更新手順

## 注意事項

- **⚠️ 必須**: ベースブランチの優先順位（develop-v2 → main）を必ず守る
- 既存の仕様書構造とフォーマットを維持
- 実装ファイルの現在の状態を正確に反映
- 変更履歴にコミットハッシュと日付を記録
- 日本語で記述（コード/APIパスは英語のまま）
- 重要な機能に焦点を当て、過度な詳細化は避ける

## 完了確認チェックリスト

- [ ] ベースブランチの優先順位確認完了（develop-v2 → main）
- [ ] 全変更ファイルの確認完了
- [ ] 仕様書の更新/作成完了
- [ ] 変更履歴の記録完了
- [ ] ユーザーへのサマリー報告完了
