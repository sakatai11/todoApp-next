---
name: coderabbit-review
description: CodeRabbit CLIでコードレビューを実行（バックグラウンド）。コードの品質チェック、セキュリティ脆弱性の検出、ベストプラクティスの検証を行い、レビュー結果を整理してユーザーに報告する。ユーザーが「コードレビュー」「CodeRabbitでレビュー」と言った時、または/coderabbit-reviewコマンドが実行された時に使用する。
---

# CodeRabbit Review

## Overview

CodeRabbit CLIを使用してコードレビューをバックグラウンドで実行し、進行状況を監視して、結果を整理してユーザーに報告する。

## Workflow

### 1. 実行前の確認

まず、以下を確認：

```bash
# 現在のブランチとコミット状況
git status
git log --oneline -5

# レビュー対象の変更内容
git diff HEAD
```

### 2. バックグラウンド実行

以下のコマンドをバックグラウンドで実行：

```bash
coderabbit --prompt-only
```

**重要**: `run_in_background: true` パラメータを使用してバックグラウンドで実行すること。

### 3. 進行状況の監視

バックグラウンド実行後、以下の手順で進行状況を確認：

1. **shell_id を記録** - バックグラウンド実行時に返される shell_id を保持
2. **定期的に出力を確認** - BashOutput ツールを使用してバックグラウンドプロセスの出力を確認
3. **ユーザーへの進行状況報告**
   - レビュー開始時: 「CodeRabbitレビューをバックグラウンドで開始しました」
   - 進行中: 定期的に出力をチェックして状況を報告
   - 完了時: レビュー結果のサマリーを表示

### 4. レビュー結果の整理

レビューが完了したら、以下の情報を整理して報告：

#### レビュー概要

- レビュー対象のファイル数
- 検出された問題の総数
- 重要度別の内訳（Critical, High, Medium, Low）

#### 主要な指摘事項

重要度の高い指摘事項をピックアップして表形式で表示：

| ファイル | 重要度 | 指摘内容 | 推奨対応 |
| -------- | ------ | -------- | -------- |
| ...      | ...    | ...      | ...      |

#### 推奨アクション

- 優先的に対応すべき項目
- 後回しにできる項目
- 議論が必要な項目

## オプション引数

コマンド実行時に引数が指定された場合の動作：

```bash
/coderabbit-review [オプション]
```

サポートされる引数：

- `--verbose` - 詳細なログ出力を表示
- `--files <pattern>` - 特定のファイルパターンのみをレビュー
- `--severity <level>` - 特定の重要度以上の問題のみを表示

例：

```bash
/coderabbit-review --files "**/*.ts" --severity high
```

引数がある場合は `$ARGUMENTS` を使用してコマンドに追加：

```bash
coderabbit --prompt-only $ARGUMENTS
```

## エラーハンドリング

以下のエラーが発生した場合の対処：

**CodeRabbit CLIが見つからない**

- インストール状況を確認
- `npm install -g @coderabbit/cli` または `brew install coderabbit` の実行を提案

**認証エラー**

- CodeRabbitの認証状態を確認
- 再認証が必要かどうかを確認

**タイムアウト**

- 大規模な変更の場合は時間がかかることを説明
- 進行状況を定期的に確認

## 注意事項

- バックグラウンド実行により、他の作業を並行して実行できる
- レビューには数分かかる場合がある（変更量により異なる）
- `--prompt-only` オプションはプロンプト生成のみを行い、実際のAI呼び出しは行わない
- ネットワーク接続が必要
- レビュー結果は標準出力に表示される

## 完了後のアクション

レビュー完了後、ユーザーに以下を確認：

1. 指摘事項の修正を開始するか？
2. 特定の指摘について詳細な説明が必要か？
3. レビュー結果をファイルに保存するか？

ユーザーの要望に応じて次のアクションを実行する。
