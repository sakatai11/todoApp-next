# TodoApp-Next E2Eテストプラン

## アプリケーション概要

TodoApp-Nextは、Next.js 15 + Firebase + NextAuth.js認証を基盤としたタスク管理アプリケーションです。主要機能として以下を提供します：

- **認証システム**: NextAuth.js v5 + Firebase Custom Token認証
- **タスク管理**: Todo作成・編集・削除・ステータス管理
- **リスト管理**: カスタムリスト作成・並び替え・削除
- **ドラッグ&ドロップ**: タスクとリストの並び替え
- **ピン留め機能**: 重要タスクの優先表示
- **レスポンシブUI**: Material-UI + Tailwind CSSによるモバイル対応

## テスト環境

### 実行環境
- **Docker開発環境**: http://localhost:3000
- **テストフレームワーク**: Playwright 1.56.1
- **ブラウザ**: Chromium, Firefox, WebKit
- **認証方式**: NextAuth.js Credentials Provider + Firebase Custom Token

### テストユーザー
テスト実行時に使用する認証情報（Docker開発環境）：

| ユーザータイプ | メールアドレス | パスワード | 説明 |
|---------------|---------------|-----------|------|
| 開発環境ユーザー | dev.user@todoapp.com | devpassword123 | Docker開発環境用テストユーザー |

### テスト実行方法
```bash
# Docker開発環境起動（別ターミナル）
npm run docker:dev

# E2Eテスト実行
npm run test:e2e           # ヘッドレスモードで実行
npm run test:e2e:ui        # Playwright UIモードで実行
npm run test:e2e:headed    # ブラウザを表示して実行
npm run test:e2e:debug     # デバッグモードで実行
```

---

## テストシナリオ一覧

### 優先度分類
- **Critical**: アプリケーションの核となる機能、失敗すると全体が使用不可
- **High**: 主要なユーザーフロー、失敗すると重大な影響
- **Medium**: 補助的機能、失敗しても代替手段あり

---

## 1. 認証フロー（Critical）

### 1.1 トップページ表示とナビゲーション
**優先度**: Critical
**目的**: 未認証ユーザーがトップページにアクセスでき、認証ページへ遷移できることを確認

**事前条件**:
- Docker開発環境が起動している（http://localhost:3000）
- ブラウザにセッション情報がない（初回アクセスまたはクリア済み）

**ステップ**:
1. ブラウザで `http://localhost:3000` にアクセス
2. トップページが表示されることを確認
   - ページタイトルが表示される
   - ナビゲーションリンク（SignIn/SignUp）が表示される
3. "SignIn"リンクをクリック
4. サインインページ（`/signin`）に遷移することを確認

**期待結果**:
- トップページが正常に表示される
- サインインページへの遷移がスムーズに完了する
- URLが `/signin` になる

**失敗条件**:
- ページが読み込まれない
- ナビゲーションリンクが機能しない
- リダイレクトループが発生する

---

### 1.2 サインイン（正常系）
**優先度**: Critical
**目的**: 有効な認証情報でユーザーがログインでき、Todoページへリダイレクトされることを確認

**事前条件**:
- サインインページ（`/signin`）が表示されている
- テストユーザーが存在する（dev.user@todoapp.com）

**ステップ**:
1. メールアドレス入力フィールドに `dev.user@todoapp.com` を入力
2. パスワード入力フィールドに `testpassword123` を入力
3. "ログイン"ボタンをクリック
4. 認証処理が完了するまで待機（ローディング状態を確認）
5. Todoページ（`/todo`）にリダイレクトされることを確認

**期待結果**:
- 入力した認証情報が受け付けられる
- ローディングインジケーターが表示される
- 認証成功後、自動的に `/todo` ページにリダイレクトされる
- ページヘッダーにログアウトボタンが表示される
- 既存のTodoとリストが表示される

**失敗条件**:
- 認証エラーメッセージが表示される
- リダイレクトが発生しない
- Todoページでエラーが表示される

---

### 1.3 サインイン（異常系：無効な認証情報）
**優先度**: High
**目的**: 無効な認証情報でログイン試行時に適切なエラーメッセージが表示されることを確認

**事前条件**:
- サインインページ（`/signin`）が表示されている

**ステップ**:
1. メールアドレス入力フィールドに `invalid@example.com` を入力
2. パスワード入力フィールドに `wrongpassword` を入力
3. "ログイン"ボタンをクリック
4. エラーメッセージが表示されることを確認

**期待結果**:
- エラーメッセージが表示される（例: "メールアドレスまたはパスワードが正しくありません"）
- サインインページに留まる
- 入力フィールドの内容が保持される（セキュリティ上、パスワードはクリアされる可能性あり）

**失敗条件**:
- エラーメッセージが表示されない
- 不正な認証でもログインできてしまう
- アプリケーションがクラッシュする

---

### 1.4 サインイン（異常系：空フィールド）
**優先度**: High
**目的**: 必須フィールドが空の状態でログイン試行時にバリデーションエラーが表示されることを確認

**事前条件**:
- サインインページ（`/signin`）が表示されている

**ステップ**:
1. メールアドレスとパスワードフィールドを空のまま
2. "ログイン"ボタンをクリック
3. バリデーションエラーメッセージが表示されることを確認

**期待結果**:
- フォームのバリデーションエラーメッセージが表示される
- ボタンがクリックできない、または入力を促すメッセージが表示される
- サーバーへのリクエストが送信されない

**失敗条件**:
- バリデーションがスキップされる
- サーバーエラーが発生する

---

### 1.5 サインアウト
**優先度**: Critical
**目的**: 認証済みユーザーがログアウトでき、サインインページにリダイレクトされることを確認

**事前条件**:
- ユーザーが認証済み（Todoページ `/todo` にアクセス可能）
- ヘッダーにログアウトボタンが表示されている

**ステップ**:
1. Todoページ（`/todo`）が表示されている状態
2. ヘッダーのログアウトボタンをクリック
3. ログアウト確認モーダルが表示される場合は"OK"をクリック
4. サインインページ（`/signin`）にリダイレクトされることを確認
5. Todoページ（`/todo`）に直接アクセスしようとすると、サインインページにリダイレクトされることを確認

**期待結果**:
- ログアウト処理が正常に完了する
- セッションがクリアされる
- サインインページにリダイレクトされる
- 保護されたページにアクセスできなくなる

**失敗条件**:
- ログアウトボタンが機能しない
- セッションが残り続ける
- リダイレクトが発生しない

---

### 1.6 サインアップ（正常系）
**優先度**: High
**目的**: 新規ユーザーがアカウントを作成でき、サインインページにリダイレクトされることを確認

**事前条件**:
- サインアップページ（`/signup`）が表示されている
- 使用するメールアドレスがシステムに未登録

**ステップ**:
1. メールアドレス入力フィールドに新規メールアドレス（例: `newuser-${Date.now()}@example.com`）を入力
2. パスワード入力フィールドに `newpassword123` を入力
3. "登録"ボタンをクリック
4. アカウント作成処理が完了するまで待機
5. サインインページ（`/signin`）にリダイレクトされることを確認
6. 作成したアカウントでログインできることを確認

**期待結果**:
- アカウント作成が正常に完了する
- サインインページにリダイレクトされる
- 成功メッセージが表示される（任意）
- 作成したアカウントでログイン可能

**失敗条件**:
- アカウント作成エラーが発生する
- リダイレクトが発生しない
- 作成したアカウントでログインできない

---

### 1.7 サインアップ（異常系：既存メールアドレス）
**優先度**: Medium
**目的**: 既に登録済みのメールアドレスでアカウント作成を試行時にエラーメッセージが表示されることを確認

**事前条件**:
- サインアップページ（`/signup`）が表示されている
- テストユーザー（dev.user@todoapp.com）が既に存在する

**ステップ**:
1. メールアドレス入力フィールドに `dev.user@todoapp.com` を入力
2. パスワード入力フィールドに `testpassword123` を入力
3. "登録"ボタンをクリック
4. エラーメッセージが表示されることを確認

**期待結果**:
- エラーメッセージが表示される（例: "このメールアドレスは既に登録されています"）
- サインアップページに留まる
- アカウントが重複作成されない

**失敗条件**:
- エラーメッセージが表示されない
- 重複アカウントが作成される
- アプリケーションがクラッシュする

---

## 2. カンバンボード表示（Critical）

### 2.1 Todoページ初期表示
**優先度**: Critical
**目的**: 認証済みユーザーがTodoページにアクセスし、既存のTodoとリストが正常に表示されることを確認

**事前条件**:
- ユーザーが認証済み（dev.user@todoapp.com）
- Docker開発環境のテストユーザーに既存のTodoとリストが存在する

**ステップ**:
1. Todoページ（`/todo`）にアクセス
2. ローディング画面が表示される（データ取得中）
3. Todoページのメインコンテンツが表示される
4. 既存のリストが表示されることを確認（最低3つのリスト）
5. 各リストにTodoが表示されることを確認
6. 新規Todo作成ボタンが表示されることを確認

**期待結果**:
- ページが正常に読み込まれる
- 既存のリスト（例: "TODO", "進行中", "完了"）が表示される
- 各リストに対応するTodoが表示される
- UI要素（ボタン、入力フィールド等）が正常に配置される
- レスポンシブデザインが適用される

**失敗条件**:
- ページが読み込まれない
- エラーメッセージが表示される
- リストやTodoが表示されない
- UIが崩れている

---

### 2.2 リストの表示とスクロール
**優先度**: Medium
**目的**: 複数のリストが正常に表示され、横スクロールが機能することを確認

**事前条件**:
- Todoページ（`/todo`）が表示されている
- 複数のリストが存在する（3つ以上）

**ステップ**:
1. Todoページのリストエリアを確認
2. 全てのリストが表示されていることを確認
3. 画面幅が狭い場合、横スクロールが可能であることを確認
4. モバイル表示に切り替え（ビューポート変更）
5. モバイルでも全リストにアクセス可能であることを確認

**期待結果**:
- 全てのリストが正常に表示される
- 横スクロールが機能する
- モバイルでもレスポンシブに表示される
- リストタイトルが読みやすい

**失敗条件**:
- 一部のリストが表示されない
- スクロールが機能しない
- モバイル表示が崩れる

---

### 2.3 Todoアイテムの詳細表示
**優先度**: High
**目的**: 各Todoアイテムの詳細情報（テキスト、ステータス、日付等）が正常に表示されることを確認

**事前条件**:
- Todoページ（`/todo`）が表示されている
- 少なくとも1つのTodoが存在する

**ステップ**:
1. Todoページのリスト内のTodoアイテムを確認
2. Todoテキストが表示されることを確認
3. ステータスアイコン（チェックボックス等）が表示されることを確認
4. 作成日時または更新日時が表示されることを確認（存在する場合）
5. アクションボタン（編集、削除等）が表示されることを確認

**期待結果**:
- Todoテキストが正常に表示される（改行、長文対応）
- ステータスが視覚的に明確（完了/未完了）
- 日付が適切にフォーマットされている
- アクションボタンが適切な位置に表示される

**失敗条件**:
- テキストが切れている、または表示されない
- ステータスが不明確
- 日付フォーマットが崩れている
- ボタンが表示されない

---

## 3. タスク管理機能（Critical）

### 3.1 新規Todo作成（正常系）
**優先度**: Critical
**目的**: ユーザーが新規Todoを作成でき、リストに正常に表示されることを確認

**事前条件**:
- Todoページ（`/todo`）が表示されている
- ユーザーが認証済み

**ステップ**:
1. 新規Todo作成ボタン（通常はページ上部またはリスト内）をクリック
2. Todo作成モーダルまたは入力フィールドが表示される
3. Todoテキスト入力フィールドに `E2Eテスト: 新規タスク - ${Date.now()}` を入力
4. ステータス選択ドロップダウンから対象リスト（例: "TODO"）を選択
5. "追加"または"作成"ボタンをクリック
6. モーダルが閉じることを確認
7. 選択したリストに新しいTodoが表示されることを確認
8. 表示されたTodoのテキストが入力内容と一致することを確認

**期待結果**:
- 入力フィールドが正常に機能する
- Todoがデータベースに保存される
- UIに即座に反映される（楽観的更新）
- 新しいTodoが正しいリストに配置される
- モーダルが自動的に閉じる

**失敗条件**:
- Todoが作成されない
- エラーメッセージが表示される
- UIに反映されない
- 間違ったリストに配置される

---

### 3.2 新規Todo作成（異常系：空テキスト）
**優先度**: High
**目的**: 空のテキストでTodo作成を試行時にバリデーションエラーが表示されることを確認

**事前条件**:
- Todo作成モーダルまたは入力フィールドが表示されている

**ステップ**:
1. Todoテキスト入力フィールドを空のまま
2. ステータス選択ドロップダウンからリストを選択（または選択しない）
3. "追加"または"作成"ボタンをクリック
4. バリデーションエラーメッセージが表示されることを確認
5. Todoが作成されないことを確認

**期待結果**:
- バリデーションエラーメッセージが表示される（例: "タスク内容を入力してください"）
- Todoが作成されない
- モーダルが開いたまま
- 入力フィールドにフォーカスが当たる（任意）

**失敗条件**:
- エラーメッセージが表示されない
- 空のTodoが作成される
- アプリケーションがクラッシュする

---

### 3.3 Todo編集（正常系）
**優先度**: Critical
**目的**: 既存のTodoを編集でき、変更が正常に保存されることを確認

**事前条件**:
- Todoページ（`/todo`）が表示されている
- 編集可能なTodoが存在する

**ステップ**:
1. 編集対象のTodoアイテムを特定
2. 編集ボタン（通常は鉛筆アイコン）をクリック
3. 編集モーダルが表示されることを確認
4. Todoテキスト入力フィールドの内容が現在のテキストで表示されることを確認
5. テキストを変更（例: 元のテキスト + " - 編集済み"）
6. 必要に応じてステータスを変更
7. "保存"または"更新"ボタンをクリック
8. モーダルが閉じることを確認
9. Todoアイテムのテキストが更新されることを確認
10. 更新日時が変更されることを確認（表示されている場合）

**期待結果**:
- 編集モーダルが正常に開く
- 現在の内容が入力フィールドに表示される
- 変更がデータベースに保存される
- UIに即座に反映される
- 更新日時が更新される

**失敗条件**:
- 編集モーダルが開かない
- 変更が保存されない
- UIに反映されない
- 元のデータが失われる

---

### 3.4 Todo削除（正常系）
**優先度**: Critical
**目的**: Todoを削除でき、リストから正常に削除されることを確認

**事前条件**:
- Todoページ（`/todo`）が表示されている
- 削除可能なTodoが存在する（テスト用に作成したTodo）

**ステップ**:
1. 削除対象のTodoアイテムを特定
2. 削除ボタン（通常はゴミ箱アイコン）をクリック
3. 削除確認モーダルが表示される場合は内容を確認
4. 削除確認モーダルの"OK"または"削除"ボタンをクリック
5. モーダルが閉じることを確認
6. Todoがリストから削除されることを確認
7. 他のTodoに影響がないことを確認

**期待結果**:
- 削除確認モーダルが表示される（誤削除防止）
- Todoがデータベースから削除される
- UIから即座に削除される
- 他のTodoは影響を受けない

**失敗条件**:
- Todoが削除されない
- 確認モーダルが表示されない
- 間違ったTodoが削除される
- UIエラーが発生する

---

### 3.5 Todo削除（異常系：キャンセル）
**優先度**: Medium
**目的**: 削除確認モーダルでキャンセルした場合、Todoが削除されないことを確認

**事前条件**:
- 削除確認モーダルが表示されている

**ステップ**:
1. 削除対象のTodoアイテムの削除ボタンをクリック
2. 削除確認モーダルが表示される
3. "キャンセル"ボタンをクリック
4. モーダルが閉じることを確認
5. Todoがリストに残っていることを確認

**期待結果**:
- モーダルが閉じる
- Todoが削除されない
- Todoの状態が変更されない

**失敗条件**:
- キャンセルしてもTodoが削除される
- モーダルが閉じない

---

### 3.6 Todo完了/未完了切り替え（ピン機能）
**優先度**: High
**目的**: Todoのステータスをチェックボックスで切り替えられ、表示が更新されることを確認

**事前条件**:
- Todoページ（`/todo`）が表示されている
- 未完了のTodoが存在する

**ステップ**:
1. 未完了のTodoアイテムを特定
2. Todoアイテムのチェックボックスをクリック（または完了ボタン）
3. Todoのステータスが"完了"に変更されることを確認
4. ピン留めアイコンや視覚的な変化を確認
5. 再度チェックボックスをクリック
6. Todoのステータスが"未完了"に戻ることを確認

**期待結果**:
- チェックボックスのクリックでステータスが切り替わる
- 視覚的フィードバックが即座に表示される（アイコン変化、色変更等）
- データベースに状態が保存される
- 繰り返し切り替えが可能

**失敗条件**:
- ステータスが変更されない
- 視覚的フィードバックがない
- データベースに保存されない
- 切り替えが1回しか機能しない

---

### 3.7 複数行テキストのTodo作成
**優先度**: Medium
**目的**: 改行を含むテキストでTodoを作成でき、正常に表示されることを確認

**事前条件**:
- Todo作成モーダルまたは入力フィールドが表示されている

**ステップ**:
1. Todoテキスト入力フィールドに複数行のテキストを入力
   ```
   E2Eテスト: 複数行タスク
   - 項目1
   - 項目2
   - 項目3
   ```
2. ステータス選択ドロップダウンからリストを選択
3. "追加"または"作成"ボタンをクリック
4. 作成されたTodoを確認
5. 改行が保持されていることを確認
6. テキストが全て表示されることを確認

**期待結果**:
- 複数行テキストが正常に保存される
- 改行が保持される
- テキストが読みやすく表示される
- 長文でもUIが崩れない

**失敗条件**:
- 改行が削除される
- テキストが途切れる
- UIレイアウトが崩れる

---

### 3.8 URLを含むTodo作成とリンク表示
**優先度**: Medium
**目的**: URL文字列を含むTodoを作成し、自動的にリンクとして表示されることを確認

**事前条件**:
- Todo作成モーダルまたは入力フィールドが表示されている

**ステップ**:
1. Todoテキスト入力フィールドにURLを含むテキストを入力（例: "参考資料: https://example.com"）
2. ステータス選択ドロップダウンからリストを選択
3. "追加"または"作成"ボタンをクリック
4. 作成されたTodoを確認
5. URL部分がクリック可能なリンクとして表示されることを確認
6. リンクをクリックして動作を確認（新規タブで開く等）

**期待結果**:
- URLが自動的にリンクとして認識される
- リンクがクリック可能
- リンククリック時に新規タブで開く
- テキストの可読性が保たれる

**失敗条件**:
- URLがリンクとして認識されない
- リンクがクリックできない
- 同じタブで開いてしまう（ユーザー体験の低下）

---

## 4. リスト管理機能（High）

### 4.1 新規リスト作成（正常系）
**優先度**: High
**目的**: ユーザーが新規リストを作成でき、カンバンボードに正常に表示されることを確認

**事前条件**:
- Todoページ（`/todo`）が表示されている
- リスト作成ボタンまたは入力フィールドが表示されている

**ステップ**:
1. 新規リスト作成ボタン（通常は"+ リスト追加"等）をクリック
2. リスト名入力フィールドが表示される
3. リスト名入力フィールドに `E2Eテストリスト - ${Date.now()}` を入力
4. "追加"または"作成"ボタンをクリック（またはEnterキーを押す）
5. 入力フィールドが閉じることを確認
6. 新しいリストがカンバンボードに表示されることを確認
7. 新しいリストが空の状態で表示されることを確認

**期待結果**:
- 入力フィールドが正常に機能する
- リストがデータベースに保存される
- UIに即座に反映される
- 新しいリストが末尾または適切な位置に配置される
- 入力フィールドが自動的にクリアされる

**失敗条件**:
- リストが作成されない
- エラーメッセージが表示される
- UIに反映されない

---

### 4.2 新規リスト作成（異常系：空のリスト名）
**優先度**: Medium
**目的**: 空のリスト名で作成を試行時にバリデーションエラーが表示されることを確認

**事前条件**:
- リスト名入力フィールドが表示されている

**ステップ**:
1. リスト名入力フィールドを空のまま
2. "追加"または"作成"ボタンをクリック（またはEnterキーを押す）
3. バリデーションエラーメッセージが表示されることを確認
4. リストが作成されないことを確認

**期待結果**:
- バリデーションエラーメッセージが表示される（例: "リスト名を入力してください"）
- リストが作成されない
- 入力フィールドが開いたまま
- 入力フィールドにフォーカスが当たる（任意）

**失敗条件**:
- エラーメッセージが表示されない
- 空のリストが作成される

---

### 4.3 新規リスト作成（異常系：重複リスト名）
**優先度**: Medium
**目的**: 既存のリスト名と同じ名前でリスト作成を試行時にバリデーションエラーが表示されることを確認

**事前条件**:
- リスト名入力フィールドが表示されている
- 既存のリスト（例: "TODO"）が存在する

**ステップ**:
1. リスト名入力フィールドに既存のリスト名（例: "TODO"）を入力
2. "追加"または"作成"ボタンをクリック
3. バリデーションエラーメッセージが表示されることを確認
4. 重複リストが作成されないことを確認

**期待結果**:
- バリデーションエラーメッセージが表示される（例: "このリスト名は既に存在します"）
- リストが重複作成されない
- 入力フィールドが開いたまま

**失敗条件**:
- エラーメッセージが表示されない
- 重複リストが作成される

---

### 4.4 リスト名変更（正常系）
**優先度**: High
**目的**: 既存のリスト名を変更でき、変更が正常に保存されることを確認

**事前条件**:
- Todoページ（`/todo`）が表示されている
- 変更可能なリスト（テスト用に作成したリスト）が存在する

**ステップ**:
1. 変更対象のリストタイトルを特定
2. リストタイトルのメニューボタン（通常は3点リーダーアイコン）をクリック
3. メニューから"リスト名を変更"を選択（またはタイトルをダブルクリック）
4. リスト名入力フィールドがアクティブになることを確認
5. リスト名を変更（例: 元の名前 + " - 編集済み"）
6. Enterキーを押す、またはフォーカスを外す
7. リスト名が更新されることを確認

**期待結果**:
- リスト名入力フィールドが編集可能になる
- 変更がデータベースに保存される
- UIに即座に反映される
- 他のリストに影響がない

**失敗条件**:
- リスト名が変更されない
- 変更が保存されない
- UIに反映されない

---

### 4.5 リスト削除（正常系）
**優先度**: High
**目的**: リストを削除でき、カンバンボードから正常に削除されることを確認

**事前条件**:
- Todoページ（`/todo`）が表示されている
- 削除可能なリスト（テスト用に作成したリスト）が存在する
- 削除対象リストにTodoが含まれていない（または削除確認が表示される）

**ステップ**:
1. 削除対象のリストタイトルを特定
2. リストタイトルのメニューボタンをクリック
3. メニューから"リストを削除"を選択
4. 削除確認モーダルが表示される場合は内容を確認
5. 削除確認モーダルの"OK"または"削除"ボタンをクリック
6. モーダルが閉じることを確認
7. リストがカンバンボードから削除されることを確認
8. 他のリストに影響がないことを確認

**期待結果**:
- 削除確認モーダルが表示される
- リストがデータベースから削除される
- UIから即座に削除される
- リスト内のTodoも削除される（仕様による）
- 他のリストは影響を受けない

**失敗条件**:
- リストが削除されない
- 確認モーダルが表示されない
- 間違ったリストが削除される
- UIエラーが発生する

---

### 4.6 リスト削除（異常系：Todoを含むリスト）
**優先度**: Medium
**目的**: Todoを含むリストを削除しようとした場合、警告メッセージが表示されることを確認

**事前条件**:
- Todoページ（`/todo`）が表示されている
- Todoを含むリストが存在する

**ステップ**:
1. Todoを含むリストのメニューボタンをクリック
2. メニューから"リストを削除"を選択
3. 削除確認モーダルが表示される
4. モーダル内に警告メッセージ（例: "このリストには○件のタスクが含まれています"）が表示されることを確認
5. "キャンセル"ボタンをクリック
6. リストが削除されないことを確認

**期待結果**:
- 警告メッセージが表示される
- ユーザーがリスクを理解できる
- キャンセル可能
- 誤削除を防止できる

**失敗条件**:
- 警告メッセージが表示されない
- Todoが含まれているのに削除できてしまう

---

## 5. ドラッグ&ドロップ機能（High）

### 5.1 リストの並び替え（ドラッグ&ドロップ）
**優先度**: High
**目的**: リストをドラッグ&ドロップで並び替えられ、順序が保存されることを確認

**事前条件**:
- Todoページ（`/todo`）が表示されている
- 複数のリスト（3つ以上）が存在する

**ステップ**:
1. リストの現在の順序を確認（例: ["TODO", "進行中", "完了"]）
2. "TODO"リストのドラッグハンドル（通常は6点アイコン）をマウスでクリック＆ホールド
3. リストを右方向にドラッグ（"進行中"と"完了"の間）
4. マウスボタンを離してドロップ
5. リストの順序が変更されることを確認（例: ["進行中", "TODO", "完了"]）
6. ページをリロードして順序が保持されることを確認

**期待結果**:
- ドラッグ中に視覚的フィードバックが表示される（リストが移動中であることを示す）
- ドロップ位置が明確に示される
- リストの順序が即座に更新される
- データベースに順序が保存される
- ページリロード後も順序が保持される

**失敗条件**:
- ドラッグ&ドロップが機能しない
- 順序が変更されない
- 保存されない
- UIがバグる

---

### 5.2 Todoの並び替え（同一リスト内）
**優先度**: High
**目的**: 同一リスト内でTodoをドラッグ&ドロップで並び替えられることを確認

**事前条件**:
- Todoページ（`/todo`）が表示されている
- 1つのリストに複数のTodo（3つ以上）が存在する

**ステップ**:
1. 対象リスト内のTodoの現在の順序を確認
2. 1番目のTodoをドラッグ開始
3. 3番目のTodoの下にドロップ
4. Todoの順序が変更されることを確認
5. ページをリロードして順序が保持されることを確認

**期待結果**:
- ドラッグ中に視覚的フィードバックが表示される
- ドロップ位置が明確に示される
- Todoの順序が即座に更新される
- データベースに順序が保存される
- ページリロード後も順序が保持される

**失敗条件**:
- ドラッグ&ドロップが機能しない
- 順序が変更されない
- 保存されない

---

### 5.3 Todoの移動（異なるリスト間）
**優先度**: High
**目的**: Todoを別のリストにドラッグ&ドロップで移動でき、ステータスが更新されることを確認

**事前条件**:
- Todoページ（`/todo`）が表示されている
- 複数のリスト（2つ以上）が存在する
- 移動元リストにTodoが存在する

**ステップ**:
1. 移動元リスト（例: "TODO"）内のTodoを特定
2. Todoのステータスを確認（例: "todo"）
3. Todoをドラッグ開始
4. 移動先リスト（例: "進行中"）にドロップ
5. Todoが移動先リストに表示されることを確認
6. Todoのステータスが更新されることを確認（例: "in-progress"）
7. 移動元リストからTodoが削除されることを確認
8. ページをリロードして移動が保持されることを確認

**期待結果**:
- ドラッグ中に視覚的フィードバックが表示される
- ドロップ先リストが強調表示される
- Todoが即座に移動する
- ステータスが自動的に更新される
- データベースに変更が保存される
- ページリロード後も移動が保持される

**失敗条件**:
- ドラッグ&ドロップが機能しない
- Todoが移動しない
- ステータスが更新されない
- 保存されない
- Todoが重複する

---

### 5.4 ドラッグ&ドロップ（モバイル対応）
**優先度**: Medium
**目的**: モバイルデバイス（タッチ操作）でもドラッグ&ドロップが機能することを確認

**事前条件**:
- Todoページ（`/todo`）がモバイルビューで表示されている（ビューポート変更）
- 複数のTodoまたはリストが存在する

**ステップ**:
1. ブラウザのビューポートをモバイルサイズに変更（例: 375x667）
2. Todoまたはリストをロングタップ
3. タッチを保持したままドラッグ
4. ドロップ先でタッチを離す
5. 並び替えまたは移動が正常に完了することを確認

**期待結果**:
- タッチ操作でドラッグ&ドロップが機能する
- モバイルでも視覚的フィードバックが表示される
- デスクトップと同様の動作が実現される

**失敗条件**:
- タッチ操作が機能しない
- スクロールと競合する
- ドロップが認識されない

---

## 6. エラーハンドリングとエッジケース（Medium）

### 6.1 ネットワークエラー時の表示
**優先度**: Medium
**目的**: ネットワークエラー発生時にエラーメッセージが表示されることを確認

**事前条件**:
- Todoページ（`/todo`）が表示されている
- ブラウザの開発者ツールでネットワークをオフラインに設定可能

**ステップ**:
1. ブラウザの開発者ツールを開く
2. ネットワークタブでオフラインモードに設定
3. Todo作成またはリスト作成を試行
4. エラーメッセージが表示されることを確認（例: "ネットワークエラーが発生しました"）
5. ネットワークをオンラインに戻す
6. 再試行ボタンをクリック（存在する場合）
7. 操作が正常に完了することを確認

**期待結果**:
- エラーメッセージが表示される
- ユーザーフレンドリーなメッセージ内容
- 再試行オプションが提供される
- ネットワーク復旧後、正常に動作する

**失敗条件**:
- エラーメッセージが表示されない
- アプリケーションがクラッシュする
- 再試行できない

---

### 6.2 セッション期限切れ時の表示
**優先度**: High
**目的**: セッション期限切れ時にログインページにリダイレクトされることを確認

**事前条件**:
- ユーザーが認証済み
- Todoページ（`/todo`）が表示されている

**ステップ**:
1. ブラウザの開発者ツールでセッションCookieを削除、またはLocalStorageをクリア
2. Todo作成または編集を試行
3. 認証エラーメッセージが表示される、またはログインページにリダイレクトされることを確認
4. サインインページで再ログイン
5. Todoページにリダイレクトされることを確認

**期待結果**:
- セッション切れが検出される
- エラーメッセージが表示される、またはログインページにリダイレクトされる
- ユーザーデータは保護される
- 再ログイン後、正常に使用可能

**失敗条件**:
- セッション切れが検出されない
- エラーハンドリングされない
- 再ログイン後も問題が続く

---

### 6.3 長文テキストのハンドリング
**優先度**: Medium
**目的**: 長文テキストでTodoを作成した場合、UIが崩れないことを確認

**事前条件**:
- Todo作成モーダルまたは入力フィールドが表示されている

**ステップ**:
1. Todoテキスト入力フィールドに長文（1000文字以上）を入力
2. ステータス選択ドロップダウンからリストを選択
3. "追加"または"作成"ボタンをクリック
4. 作成されたTodoを確認
5. テキストが適切に表示されることを確認（省略表示、スクロール等）
6. 編集モーダルでも長文が正常に表示されることを確認

**期待結果**:
- 長文が正常に保存される
- UIレイアウトが崩れない
- テキストが読みやすく表示される（省略、スクロール等）
- パフォーマンスに影響がない

**失敗条件**:
- 文字数制限でエラーになる（想定外の場合）
- UIが崩れる
- 表示が遅い

---

### 6.4 特殊文字のハンドリング
**優先度**: Medium
**目的**: 特殊文字（絵文字、記号等）を含むテキストが正常に処理されることを確認

**事前条件**:
- Todo作成モーダルまたは入力フィールドが表示されている

**ステップ**:
1. Todoテキスト入力フィールドに特殊文字を含むテキストを入力（例: "E2Eテスト 🚀💻 <特殊> & \"文字\" テスト"）
2. ステータス選択ドロップダウンからリストを選択
3. "追加"または"作成"ボタンをクリック
4. 作成されたTodoを確認
5. 特殊文字が正常に表示されることを確認
6. XSS攻撃（例: `<script>alert('XSS')</script>`）が無効化されることを確認

**期待結果**:
- 特殊文字が正常に保存・表示される
- 絵文字が正しく表示される
- HTMLタグがエスケープされる（XSS対策）
- セキュリティが保たれる

**失敗条件**:
- 特殊文字が文字化けする
- XSSが実行される
- データが破損する

---

### 6.5 同時編集の競合ハンドリング
**優先度**: Low
**目的**: 複数のブラウザタブで同時編集した場合の動作を確認

**事前条件**:
- Todoページ（`/todo`）が2つのブラウザタブで開かれている

**ステップ**:
1. タブ1でTodoを編集開始
2. タブ2でも同じTodoを編集開始
3. タブ1で編集を保存
4. タブ2で編集を保存しようとする
5. 競合警告が表示される、または最新の変更が上書きされることを確認

**期待結果**:
- 競合が検出される（任意）
- 最新の変更が保存される
- データの整合性が保たれる

**失敗条件**:
- データが破損する
- 変更が失われる

---

## 7. レスポンシブデザイン（Medium）

### 7.1 モバイル表示の確認
**優先度**: Medium
**目的**: モバイルデバイスでUIが正常に表示されることを確認

**事前条件**:
- Todoページ（`/todo`）が表示されている

**ステップ**:
1. ブラウザのビューポートをモバイルサイズに変更（例: 375x667）
2. 全ての要素が画面内に収まることを確認
3. スクロールが正常に機能することを確認
4. ボタンやリンクがタップ可能なサイズであることを確認
5. テキストが読みやすいサイズであることを確認
6. モーダルがモバイル画面に適切に表示されることを確認

**期待結果**:
- レイアウトがモバイルに最適化される
- 全ての要素がアクセス可能
- タップターゲットサイズが適切（最低44x44px）
- テキストが読みやすい
- ナビゲーションが使いやすい

**失敗条件**:
- レイアウトが崩れる
- 要素が画面外に表示される
- ボタンが小さすぎてタップできない

---

### 7.2 タブレット表示の確認
**優先度**: Low
**目的**: タブレットデバイスでUIが正常に表示されることを確認

**事前条件**:
- Todoページ（`/todo`）が表示されている

**ステップ**:
1. ブラウザのビューポートをタブレットサイズに変更（例: 768x1024）
2. レイアウトが適切に調整されることを確認
3. リストが適切な幅で表示されることを確認
4. 全ての機能が正常に動作することを確認

**期待結果**:
- レイアウトがタブレットに最適化される
- デスクトップとモバイルの中間的な表示
- 全ての機能が使用可能

**失敗条件**:
- レイアウトが不適切
- 一部の要素が表示されない

---

### 7.3 デスクトップ（大画面）表示の確認
**優先度**: Medium
**目的**: 大画面デスクトップでUIが正常に表示されることを確認

**事前条件**:
- Todoページ（`/todo`）が表示されている

**ステップ**:
1. ブラウザのビューポートを大画面サイズに変更（例: 1920x1080）
2. レイアウトが適切にスケールすることを確認
3. リストが適切な幅で表示され、過度に広がらないことを確認
4. テキストが読みやすいサイズであることを確認

**期待結果**:
- レイアウトが大画面に最適化される
- 最大幅制限が適用される（デザインによる）
- テキストが読みやすい
- 空白スペースが適切に使用される

**失敗条件**:
- レイアウトが過度に広がる
- テキストが小さすぎる/大きすぎる

---

## 8. パフォーマンスとアクセシビリティ（Low）

### 8.1 ページ読み込み速度の確認
**優先度**: Low
**目的**: ページが妥当な時間内に読み込まれることを確認

**事前条件**:
- ブラウザの開発者ツールでパフォーマンスタブを開く

**ステップ**:
1. Todoページ（`/todo`）にアクセス
2. ページ読み込み時間を測定
3. 3秒以内に初期表示が完了することを確認
4. インタラクティブになるまでの時間を確認

**期待結果**:
- 初期表示が3秒以内
- インタラクティブになるまで5秒以内
- スムーズなアニメーション
- 遅延が感じられない

**失敗条件**:
- 読み込みが遅い（5秒以上）
- アニメーションがカクつく

---

### 8.2 キーボードナビゲーションの確認
**優先度**: Medium
**目的**: キーボードのみで全ての機能にアクセスできることを確認

**事前条件**:
- Todoページ（`/todo`）が表示されている

**ステップ**:
1. Tabキーでフォーカスを移動
2. 全てのインタラクティブ要素（ボタン、リンク、入力フィールド）にフォーカスが当たることを確認
3. フォーカスが視覚的に明確であることを確認
4. Enterキーまたはスペースキーで操作が実行できることを確認
5. モーダルがEscキーで閉じることを確認

**期待結果**:
- 全ての要素がキーボードでアクセス可能
- フォーカスインジケーターが明確
- 論理的なタブ順序
- キーボードショートカットが機能する

**失敗条件**:
- 一部の要素にフォーカスが当たらない
- フォーカスインジケーターが見えない
- キーボード操作が機能しない

---

### 8.3 スクリーンリーダー対応の確認
**優先度**: Low
**目的**: スクリーンリーダーで主要な情報が読み上げられることを確認

**事前条件**:
- Todoページ（`/todo`）が表示されている
- スクリーンリーダー（VoiceOver、NVDA等）が起動している

**ステップ**:
1. スクリーンリーダーでページをナビゲート
2. ページタイトルが読み上げられることを確認
3. リストタイトルが読み上げられることを確認
4. Todoテキストが読み上げられることを確認
5. ボタンやリンクのラベルが適切であることを確認

**期待結果**:
- 適切なARIAラベルが設定されている
- セマンティックHTMLが使用されている
- スクリーンリーダーで全ての情報が取得可能

**失敗条件**:
- ラベルが不適切
- 一部の情報が読み上げられない

---

## テストデータ管理

### テスト前の準備
- Docker開発環境が起動していることを確認（`npm run docker:dev`）
- テストユーザー（dev.user@todoapp.com / devpassword123）が存在することを確認
- ブラウザのセッション情報をクリア（初回テスト時）

### テスト後のクリーンアップ
- テスト用に作成したTodoを削除（`E2Eテスト:` プレフィックス付き）
- テスト用に作成したリストを削除（`E2Eテストリスト` プレフィックス付き）
- サインアップテストで作成したアカウントを削除（任意）
- セッションをクリア

### データ識別方法
テスト用データの識別のため、以下のプレフィックスを使用：
- Todo: `E2Eテスト: [タスク内容]`
- リスト: `E2Eテストリスト - [タイムスタンプ]`
- アカウント: `newuser-${Date.now()}@example.com`

---

## 実行優先順位

### Phase 1: Critical（最優先）
1. 認証フロー（1.1, 1.2, 1.5）
2. カンバンボード表示（2.1）
3. タスク管理基本機能（3.1, 3.3, 3.4）

### Phase 2: High（重要）
1. 認証異常系（1.3, 1.4）
2. リスト管理（4.1, 4.4, 4.5）
3. ドラッグ&ドロップ（5.1, 5.2, 5.3）
4. エラーハンドリング（6.2）

### Phase 3: Medium（追加機能）
1. Todo作成異常系（3.2）
2. リスト管理異常系（4.2, 4.3, 4.6）
3. その他タスク管理（3.6, 3.7, 3.8）
4. レスポンシブデザイン（7.1, 7.3）

### Phase 4: Low（オプション）
1. アクセシビリティ（8.2, 8.3）
2. エッジケース（6.3, 6.4, 6.5）
3. パフォーマンス（8.1）

---

## 既知の課題と制約

### 技術的制約
- NextAuth.js v5はベータ版のため、認証フローが変更される可能性
- Firebase Emulator使用時、本番環境と動作が異なる場合がある
- @dnd-kit/coreのモバイル対応は環境に依存

### テスト環境の制約
- Docker開発環境（localhost:3000）でのテストのため、本番環境と完全には一致しない
- ネットワーク遅延のシミュレーションが必要な場合、開発者ツールを使用
- マルチユーザー同時編集のテストは限定的

### 今後の拡張計画
- CI/CD環境でのPlaywright自動実行
- ビジュアルリグレッションテストの追加
- パフォーマンス測定の自動化
- クロスブラウザテストの拡充

---

## 関連ドキュメント

- [プロジェクト概要](/Users/sakaitaichi/workspace/todoApp-next/CLAUDE.md)
- [Todoコンポーネント仕様](/Users/sakaitaichi/workspace/todoApp-next/todoApp-submodule/docs/features/todo/components/components-spec.md)
- [統合テストガイド](/Users/sakaitaichi/workspace/todoApp-next/todoApp-submodule/docs/tests/IT_TEST.md)
- [E2Eテストガイド](/Users/sakaitaichi/workspace/todoApp-next/todoApp-submodule/docs/tests/E2E_TEST.md)
- [Playwright設定](/Users/sakaitaichi/workspace/todoApp-next/playwright.config.ts)

---

**作成日**: 2025-10-21
**バージョン**: 1.0.0
**対象アプリケーション**: TodoApp-Next (Next.js 15)
