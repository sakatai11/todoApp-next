# Playwright MCP 自然言語E2Eテスト仕様書

## テスト環境設定

### 基本設定
- **実行環境**: Docker環境
- **ブラウザ**: Chromium (デフォルト)
- **ベースURL**: http://localhost:3002
- **テストユーザー**: 
  - Email: sakai111893@gmail.com
  - Password: testpassword123

### 前提条件
- Docker環境が起動済み (`npm run docker:test`)
- Firebase Emulator環境が起動済み (ポート4000/8080/9099)
- Next.jsアプリがポート3002で起動済み
- テストデータが初期化済み

## テストシナリオ

### シナリオ1: ユーザー認証フロー
```
ユーザーがサインインページにアクセスし、
テストアカウント（sakai111893@gmail.com / testpassword123）でログインし、
Todoページに正常に遷移することを確認する
```

**期待結果**:
- ログイン成功後、URLが `/todo` を含む
- Todo一覧画面が表示される
- ユーザー情報が正しく表示される

### シナリオ2: Todo基本操作
```
ログイン済みユーザーが、
「E2Eテストで作成したTodo」という新しいタスクを作成し、
作成されたタスクが一覧に表示されることを確認し、
そのタスクを編集して「編集済みTodo」に変更し、
最終的にタスクを削除する
```

**期待結果**:
- 新しいTodoが正常に作成される
- 編集後のテキストが正しく反映される
- 削除後、タスクが一覧から消える

### シナリオ3: ステータス変更とピン留め
```
新しいTodo「重要なタスク」を作成し、
ステータスを「in-progress」から「done」に変更し、
そのタスクをピン留めし、
ピン留めセクションに表示されることを確認する
```

**期待結果**:
- ステータス変更が正しく反映される
- ピン留めアイコンが表示される
- ピン留めセクションにタスクが移動する

### シナリオ4: ドラッグ&ドロップ機能
```
2つのTodo「タスク1」「タスク2」を作成し、
ドラッグ&ドロップで順序を入れ替え、
変更が正しく反映されることを確認する
```

**期待結果**:
- ドラッグ&ドロップ操作が正常に動作する
- タスクの順序が視覚的に変更される
- 順序変更がデータベースに保存される

### シナリオ5: リスト管理機能
```
新しいリスト「テスト用リスト」を作成し、
リスト切り替え機能を使用して新しいリストに移動し、
そのリスト内でTodoを作成・管理する
```

**期待結果**:
- 新しいリストが正常に作成される
- リスト切り替えが正しく動作する
- リスト固有のTodoが管理される

### シナリオ6: レスポンシブデザイン確認
```
画面サイズをモバイル（375x667）に変更し、
モバイルメニューが正常に動作することを確認し、
モバイル環境でのTodo操作が正常に行えることを確認する
```

**期待結果**:
- モバイルメニューが表示される
- タッチ操作が正常に動作する
- レスポンシブレイアウトが適用される

### シナリオ7: サインアウト機能確認
```
ログイン済みユーザーが、
サインアウトボタンをクリックし、
正常にログアウトされることを確認し、
ログイン画面にリダイレクトされることを確認する
```

**期待結果**:
- サインアウトボタンが正常に動作する
- セッション情報が正しくクリアされる
- ログイン画面（/signin）にリダイレクトされる
- 保護されたページへのアクセスが制限される

## テスト実行条件

### 成功判定基準
- 全てのUI要素が期待通りに表示される
- ユーザー操作が正常に受け付けられる
- データの作成・更新・削除が正しく実行される
- エラーが発生しない

### 失敗時の対応
- スクリーンショットの自動取得
- エラーログの記録
- 失敗したステップの詳細情報保存

### タイムアウト設定
- ページ遷移: 30秒
- 要素の表示待機: 10秒
- API通信: 15秒

## 使用するセレクター

### 主要なdata-testid
- `email-input`: メールアドレス入力フィールド
- `password-input`: パスワード入力フィールド
- `login-button`: ログインボタン
- `logout-button`: ログアウトボタン
- `todo-input`: Todo入力フィールド
- `add-todo-button`: Todo追加ボタン
- `todo-list`: Todo一覧エリア
- `todo-item-*`: 個別Todoアイテム
- `edit-button`: 編集ボタン
- `delete-button`: 削除ボタン
- `pin-button`: ピン留めボタン
- `status-select`: ステータス選択
- `confirm-delete-button`: 削除確認ボタン

## Docker環境接続情報

- **Next.jsアプリ**: http://localhost:3002
- **Firebase Emulator UI**: http://localhost:4000
- **Firestore Emulator**: localhost:8080
- **Auth Emulator**: localhost:9099

## 注意事項

- テスト実行前にDocker環境が完全に起動していることを確認
- Firebase Emulatorの初期化完了を待つ
- テストデータの初期化 (`scripts/init-firebase-data.ts`) が完了していることを確認
- ネットワーク状況による遅延を考慮したタイムアウト設定
- Docker環境でのポート競合に注意
- サブエージェント経由でのテスト実行を前提とした設計